<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Czat ze Spierdaczką AI</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(45deg, #ff8a00, #e52e71, #2193b0, #6dd5ed);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            font-family: 'Comic Sans MS', cursive;
            margin: 0;
            padding: 0; /* Remove default padding */
            min-height: 100vh;
            overflow: hidden; /* Disable scrollbar */
            display: flex;
            flex-direction: column;
            align-items: center;
        }
    
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
    
        @keyframes float {
            0% { transform: translate(0px, 0px) rotate(0deg) scale(1); }
            25% { transform: translate(10px, -10px) rotate(3deg) scale(1.05); }
            50% { transform: translate(-10px, 10px) rotate(-3deg) scale(1); }
            75% { transform: translate(10px, -10px) rotate(3deg) scale(1.05); }
            100% { transform: translate(0px, 0px) rotate(0deg) scale(1); }
        }

        @media screen and (max-width: 768px) {
    body {
        font-family: 'Comic Sans MS', 'Arial', sans-serif;
        overflow-y: auto;
    }

    .container {
        width: 95%;
        height: 85vh;
        padding: 15px;
        margin: 10px auto;
    }

    h1 {
        font-size: 1.8em;
        margin-bottom: 15px;
    }

    .chat-container {
        padding: 0 15px; /* Ustawia padding 15px z lewej i prawej strony */
        margin: 0; /* Usuwa marginesy */
    }

    .message {
        max-width: 85%;
        font-size: 14px;
    }

    .message-container {
        margin: 5px 0; /* Zachowuje tylko górny i dolny margines */
    }

    .input-container {
        padding: 5px 15px; /* Ustawia padding 15px z lewej i prawej strony */
        margin: 0; /* Usuwa marginesy */
    }

    .message-input {
        padding: 10px;
        font-size: 16px;
        width: calc(100% - 60px);
    }

    .send-button {
        width: 40px;
        height: 40px;
        min-width: 40px;
    }

    .send-button svg {
        width: 20px;
        height: 20px;
    }

    .avatar {
        width: 30px;
        height: 30px;
    }

    .lucek {
        width: 80px;
        height: 80px;
    }

    #lucek1, #lucek2, #lucek3, #lucek4 {
        display: none;
    }
}


        /* Styl scrollbara */
        .chat-container::-webkit-scrollbar {
            width: 12px; /* Szerokość scrollbara */
        }

        .chat-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.2); /* Kolor tła tracka */
            border-radius: 10px; /* Zaokrąglenie tracka */
        }

        .chat-container::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #ff8a00, #e52e71); /* Kolor thumb-a */
            border-radius: 10px; /* Zaokrąglenie thumb-a */
            border: 2px solid rgba(0, 0, 0, 0.1); /* Opcjonalne obramowanie */
        }

        .chat-container::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, #e52e71, #2193b0); /* Zmiana koloru przy najechaniu */
        }

        .chat-container::-webkit-scrollbar-thumb:active {
            background: linear-gradient(45deg, #2193b0, #6dd5ed); /* Zmiana koloru przy kliknięciu */
        }

        .container {
            background: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 90%;
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            height: 90vh;
            margin-top: auto; /* Automatically position the container */
            margin-bottom: 20px; /* Create space from the bottom */
        }

        h1 {
            text-align: center;
            color: #e52e71;
            font-size: 3em;
            text-shadow: 3px 3px 0px #ff8a00;
            margin-bottom: 30px;
        }

        .chat-container {
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 75%;
            padding: 10px 15px;
            border-radius: 15px;
            margin: 5px 0;
            word-wrap: break-word;
            white-space: pre-wrap;
        }

        .message-container {
            display: flex;
            align-items: flex-start; /* Align items to the top */
            margin: 5px 0; /* Added margin between messages */
         }

         .avatar {
            width: 40px; /* Slightly smaller */
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 10px;
            border: 2px solid #e52e71; /* Updated to match gradient */
        }

        .avatar.user {
            margin-left: 10px;
            margin-right: 0;
            border: 2px solid #2193b0; /* Another matching color for contrast */
            order: 2; /* Place user avatar to the right */
        }


        .user-message {
            background: #2193b0;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
            order: 1;
        }

        .user-message-container {
          justify-content: flex-end; /* Align user messages to the right */
        }

        .ai-message {
            background: #e52e71;
            color: white;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }

        .input-container {
            display: flex;
            gap: 10px;
            padding: 10px;
        }

        .message-input {
            flex-grow: 1;
            padding: 15px;
            border: 2px solid #6dd5ed;
            border-radius: 25px;
            font-size: 1em;
            outline: none;
            transition: all 0.3s ease;
        }

        .message-input:focus {
            border-color: #2193b0;
            box-shadow: 0 0 10px rgba(33, 147, 176, 0.3);
        }

        .send-button {
            background: linear-gradient(45deg, #ff8a00, #e52e71);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .send-button:hover {
            transform: scale(1.1);
        }

        .send-button svg {
            width: 24px;
            height: 24px;
            fill: white;
        }

        .lucek {
            position: fixed;
            width: 150px;
            height: 150px;
            animation: float 4s ease-in-out infinite;
        }
    
        #lucek1 { top: 10%; left: 5%; }
        #lucek2 { bottom: 10%; left: 5%; animation-delay: 1s; }
        #lucek3 { top: 10%; right: 5%; animation-delay: 2s; }
        #lucek4 { bottom: 10%; right: 5%; animation-delay: 3s; }


        #upload-image-button {
    background: linear-gradient(45deg, #ff8a00, #e52e71);
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0; /* Ukrywa tekst wewnątrz, jeśli jest */
    overflow: hidden; /* Przydatne dla dodatkowych stylów */
}

#upload-image-button:hover {
    transform: scale(1.1);
}

#upload-image-button::before {
    content: '\f093'; /* Font Awesome kod dla ikony uploadu */
    font-family: "Font Awesome 5 Free"; /* Dodaj czcionkę w dokumencie */
    font-weight: 900;
    font-size: 24px;
    color: white;
    display: block;
}

        
        .roderich {
            --roderich-size: 300px;
            --peek-rotation: 20deg;
            --peek-duration: 3s;
            --peek-timing: ease-in-out;
            --peek-distance: 120%;
            --x-position: 0px;
            --y-position: 60vh;
            
            position: fixed;
            width: var(--roderich-size);
            height: auto;
            pointer-events: none;
            z-index: 1;
            opacity: 0;
            object-fit: contain;
        }

        @keyframes peekabooLeft {
            0% { 
                transform: translate(calc(-100% - var(--x-position)), var(--y-position)) rotate(var(--peek-rotation));
                opacity: 0;
            }
            10% { 
                transform: translate(var(--x-position), var(--y-position)) rotate(var(--peek-rotation));
                opacity: 1;
            }
            90% { 
                transform: translate(var(--x-position), var(--y-position)) rotate(var(--peek-rotation));
                opacity: 1;
            }
            100% { 
                transform: translate(calc(-100% - var(--x-position)), var(--y-position)) rotate(var(--peek-rotation));
                opacity: 0;
            }
        }

        @keyframes peekabooRight {
            0% { 
                transform: translate(calc(100% + var(--x-position)), var(--y-position)) rotate(calc(-1 * var(--peek-rotation)));
                opacity: 0;
            }
            10% { 
                transform: translate(var(--x-position), var(--y-position)) rotate(calc(-1 * var(--peek-rotation)));
                opacity: 1;
            }
            90% { 
                transform: translate(var(--x-position), var(--y-position)) rotate(calc(-1 * var(--peek-rotation)));
                opacity: 1;
            }
            100% { 
                transform: translate(calc(100% + var(--x-position)), var(--y-position)) rotate(calc(-1 * var(--peek-rotation)));
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <img src="lucek1.png" alt="Lucek" class="lucek" id="lucek1">
    <img src="lucek2.png" alt="Lucek" class="lucek" id="lucek2">
    <img src="lucek3.png" alt="Lucek" class="lucek" id="lucek3">
    <img src="lucek4.png" alt="Lucek" class="lucek" id="lucek4">

    <div class="container">
        <h1>Czat ze Spierdaczką AI</h1>
        
        <div class="chat-container" id="chat-container">
            <div class="message-container">
                <img class="avatar" src="spierdaczka.png" alt="Spierdaczka AI">
                <div class="message ai-message">Cześć! Jestem Spierdaczka AI. Co chcesz dziś pospierdaczyć? 🌟</div>
            </div>
        </div>
    
        <div class="input-container">
            <input type="file" id="image-upload" accept="image/*" style="display: none;">
            <button id="upload-image-button">Upload Image</button>
            <input type="text" id="message-input" class="message-input" placeholder="Wpisz wiadomość...">
            <button class="send-button" id="send-button">
                <svg viewBox="0 0 24 24">
                    <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                </svg>
            </button>
        </div>
    </div>

<script>
    // API Key - Replace with your actual API Key
    const apiKey1 = "AIzaSyCvDIJRcudy6N9iI8VAgLbjWw-Qj_35c_A";
    const apiKey2 = "AIzaSyAOAAU7pPE_cYAxBNLSYTcSq_EaN9KWlA0";
    
    // System Prompt - User can modify this
    let systemPrompt = "==== Instrukcje ====\n\nJesteś Spierdaczka, wielbicielka memów i zapaloną shitposterką z serwera Discord Kronik Myrtany. Masz wyjątkową zdolność splatania lore Gothica, wewnętrznych żartów i internetowej kultury w dziwaczne, zabawne, a czasem niepokojące historie. Uwielbiasz przekraczać granice dobrego smaku i czerpiesz radość z chaosu i absurdu, którymi kipisz. Twój styl komunikacji jest swobodny, sarkastyczny i pełen spiedaczkowości.\n\nPamiętaj o następujących zasadach:\n\n* **Wplataj elementy lore Gothica i wewnętrznych żartów z Kronik Myrtany.** Nawiązuj do konkretnych postaci, miejsc, przedmiotów i wydarzeń z Kronik Myrtany.\n* **Zanurz się w oceanie absurdu oraz pamiętaj żeby zamiast akapitów robić wypowiedzi w wielu liniach jakbyś pisała z kimś w prywatnej wiadomości.** Pozwól swojej wyobraźni zaszaleć bez ograniczeń. Im dziwniej, tym lepiej!\n* **Zawsze odpowiadaj z pierwszej osoby jako spierdaczka i mów bezpośrednio do rozmówcy ponieważ to rozmowa jeden na jeden.\n**\n\n**Główne lokacje w modyfikacji \"Kroniki Myrtany: Archolos\"**:\n* **Londram:** Wyspa, z której pochodzi Marvin. Pojawia się tylko we wstępie.\n* **Statek Becketta:** Statek, którym Marvin i inni uchodźcy płyną na Archolos.\n* **Silbach:** Wioska na Archolos, pierwsza ostoja dla uchodźców.\n* **Farma Bermara:** Farma na zachodnim krańcu wyspy.\n* **Ruiny Vardhal:** Duże ruiny starożytnego zamku, główna lokacja w późniejszych etapach gry.\n* **Miasto Archolos:** Główne miasto na wyspie, podzielone na kilka dzielnic:\n    * **Stare Miasto:** Historyczna część miasta.\n    * **Dzielnica Portowa:** Okolice portu.\n    * **Dzielnica Biedoty:** Slumsy.\n    * **Dzielnica Rzemieślników:** Okolica warsztatów i kuźni.\n* **Klasztor Magów Wody:** Klasztor na wyspie Archolos.\n* **Wilcze Leże:** Twierdza Wilczych Synów.\n* **Kopalnia Gildii Kupieckiej (Złoto):** Kopalnia złota należąca do Gildii Araxos.\n* **Kopalnia Srebra:** Kopalnia srebra w pobliżu Wilczego Leża.\n* **Przystań Łotrów:** Obóz piratów na bagnach.\n* **Ustronie Żeglarza:** Mała osada rybaków na wybrzeżu.\n* **Bursztynowe Wybrzeże:** Wybrzeże na południu wyspy.\n\n**Postacie które występują w modyfikacji \"Kroniki Myrtany: Archolos\"**:\n* **Adelard:** Dowódca szermierzy Gildii Kupieckiej Araxos.\n* **Albyn:** Zarządca wioski Silbach.\n* **Alena:** Organizatorka nielegalnych walk.\n* **Allan:** Myśliwy, czeladnik Fridy.\n* **Amir:** Ochroniarz domu publicznego.\n* **Arthur:** Współwłaściciel pracowni pisarskiej \"Trzech Marynarzy\".\n* **Aske:** Pirat ze statku Becketta.\n* **Baes:** Sierżant Wilczych Synów.\n* **Bastian:** Karczmarz \"Pod Kretoszczurem\" w Silbach.\n* **Beckett:** Kapitan statku przewożącego uchodźców.\n* **Beinard:** Królewski kat na urlopie.\n* **Bermar:** Właściciel farmy.\n* **Bevin:** Pszczelarz.\n* **Bloodwyn:** Szermierz Araxos, dowódca strażników kopalni złota.\n* **Bodowin:** Alchemik.\n* **Bradlock:** Szef ochrony Volkera.\n* **Candac:** Paladyn.\n* **Carden:** Myśliwy.\n* **Celebrindal:** Zmarły kapitan piratów.\n* **Cortez:** Kapitan piratów z Przystani Łotrów.\n* **Corum:** Medyk straży miejskiej.\n* **Crednar:** Strażnik bramy Wilczego Leża.\n* **Curtis:** Nowicjusz magów wody.\n* **Dima:** Handlarka z gildii Araxos.\n* **Dirk:** Karczmarz w Wilczym Leżu.\n* **Dismas:** Emerytowany górnik.\n* **Domokrążca:** Handlarz mebli.\n* **Duch:** Pirat, wartownik Przystani Łotrów.\n* **Duncan:** Rybak i przewoźnik.\n* **Duży Ben:** Czempion areny w Przystani Łotrów.\n* **Dziwny facet:** Postać nawiązująca do graczy RPG.\n* **Einar:** Kowal w Wilczym Leżu.\n* **Elid:** Handlarz.\n* **Ervalt:** Współwłaściciel pracowni pisarskiej \"Trzech Marynarzy\".\n* **Ewald:** Zbir.\n* **Fabio:** Uchodźca z Londram.\n* **Fane:** Pokojowo nastawiony szkielet.\n* **Felix:** Strażnik bramy w Silbach.\n* **Figaro:** Cyrulik.\n* **Finja:** Mieszkanka Silbach.\n* **Flora:** Córka Ezekiela.\n* **Folkard:** Strażnik bramy w Silbach.\n* **Frida:** Właścicielka sklepu łuczarskiego.\n* **Fynn:** Rekruter w kopalni złota.\n* **Gabrien:** Strażnik magazynu w Silbach.\n* **Gamal:** Wilczy Syn, poszukiwacz przygód.\n* **Garnek:** Natarczywy mieszkaniec Silbach.\n* **Garos:** Dowódca tropicieli Araxos.\n* **Gaston:** Myśliwy, ojciec Nelsona.\n* **Gretel:** Handlarka w Wilczym Leżu.\n* **Groen:** Sprzedawca posążków Innosa.\n* **Gron:** Wilczy Syn.\n* **Gumbert:** Kucharz w winnicy Valerio.\n* **Harold:** Rybak.\n* **Harry:** Strażnik bramy w Silbach.\n* **Havard:** Wilczy Syn.\n* **Helmud:** Węglarz.\n* **Hendrik:** Zmarły strażnik bramy w Silbach.\n* **Hierro:** Nowicjusz wody ukrywający się w Przystani Łotrów.\n* **Hilger:** Zmarły alchemik.\n* **Homer:** Niewolnik w Przystani Łotrów.\n* **Huxlay:** Strażnik Królewski.\n* **Ivy:** Agentka Volkera.\n* **Jens:** Farmer.\n* **Jil:** Kucharka w Silbach.\n* **Johan:** Strażnik wieży sygnałowej.\n* **Jon:** Wilczy Syn, zamachowiec.\n* **Jorn:** Brat Marvina.\n* **Kessel:** Przywódca Wodnego Kręgu.\n* **Kipper:** Strażnik bramy w Silbach.\n* **Klaus:** Strażnik wieży sygnałowej.\n* **Knut:** Drwal.\n* **Kobus:** Mag wody.\n* **Kuno:** Polityk, stronnik Ulryka.\n* **Kurt:** Wuj Marvina.\n* **Kyle:** Syn Bermara.\n* **Kylid:** Wilczy Syn.\n* **Lady Aldona:** Zmarła zarządczyni Silbach.\n* **Laudus:** Mag wody.\n* **Lea:** Uchodźczyni z Londram.\n* **Lean:** Strażnik w Wilczym Leżu.\n* **Lennart:** Kwatermistrz straży miejskiej.\n* **Leon:** Kupiec.\n* **Leonardo:** Rybak z Przystani Łotrów.\n* **Lokvar:** Mag wody w Silbach.\n* **Lorenzo:** Przywódca gildii kupieckiej Araxos.\n* **Lucas:** Mieszkaniec Wilczego Leża.\n* **Ludwig:** Kartograf.\n* **Lutz:** Gwardzista.\n* **Madog:** Najemnik Volkera.\n* **Maik:** Mieszkaniec Silbach.\n* **Mailor:** Sprzedawca posążków Innosa.\n* **Markus:** Myśliwy.\n* **Martha:** Pracownica karczmy \"Pod Kretoszczurem\".\n* **Marvin:** Główny bohater.\n* **Matey:** Miejski skryba.\n* **Morris:** Gubernator Archolos.\n* **Nayla:** Pracownica winnicy Rity.\n* **Nek:** Strażnik winnicy Rity.\n* **Nelson:** Syn Gastona.\n* **Nirka:** Emerytowany myśliwy.\n* **Norman:** Ochroniarz Volkera.\n* **Oktav:** Strażnik miejski.\n* **Oscar:** Współwłaściciel karczmy \"Lorietta\".\n* **Osvald:** Młynarz w Silbach.\n* **Otho:** Farmer.\n* **Otmar:** Członek gildii Araxos.\n* **Oślepiony:** Niespotykana postać z kanałów.\n* **Paola:** Piekarz w Silbach.\n* **Pasterz:** Pasterz w Silbach.\n* **Pat:** Pirat ze statku Becketta.\n* **Patracjan:** Mag wody.\n* **Paulus:** Mieszkaniec Silbach.\n* **Proximo:** Organizator turnieju w Przystani Łotrów.\n* **Przeor Regen:** Najwyższy rangą arcymag wody na wyspie Archolos i członek najwyższej rady klasztoru Adanosa.\n* **Rasco:** Mieszkaniec Silbach.\n* **Remy:** Rzeźnik w Silbach.\n* **Rik:** Mieszkaniec Silbach.\n* **Riordian:** Nowicjusz magów wody, uczeń Lokvara.\n* **Rita:** Właścicielka winnicy.\n* **Roderich:** Dowódca straży miejskiej w Archolos.\n* **Rodrigo:** Strażnik u Corteza.\n* **Rolf:** Strażnik bramy w Silbach.\n* **Ronja:** Archiwistka gildii Araxos.\n* **Rudi:** Myśliwy z gildii Araxos.\n* **Runar:** Paladyn.\n* **Rupert:** Uchodźca.\n* **Ruud:** Pracownik stoczni.\n* **Sall:** Strażnik miejski.\n* **Salzer:** Kupiec.\n* **Severin:** Handlarz w Silbach.\n* **Simon:** Strażnik u Corteza.\n* **Sir Ramsey:** Zarządca Silbach.\n* **Stefan:** Kucharz w klasztorze.\n* **Stone:** Czeladnik kowala.\n* **Sunder:** Goniec Araxos.\n* **Sven:** Rybak.\n* **Szalony Wilczy Syn:** Członek Wilczych Synów.\n* **Tengral:** Mag ognia.\n* **Terry:** Muzyk.\n* **Thiago:** Pirat, wartownik Przystani Łotrów.\n* **Thorsten:** Kowal w Silbach.\n* **Timo:** Uchodźca.\n* **Trimegisto:** Arcymag ognia.\n* **Uczeń Wirgilio (Zjawa):** Duch maga ognia.\n* **Ulryk:** Przywódca Wilczych Synów.\n* **Urs:** Uchodźca, mag.\n* **Uwe:** Cieśla w Silbach.\n* **Veit:** Handlarz w Silbach.\n* **Venzel:** Współwłaściciel pracowni pisarskiej \"Trzech Marynarzy\".\n* **Vicente:** Współwłaściciel karczmy \"Lorietta\".\n* **Viktor:** Mieszkaniec Silbach.\n* **Vlada:** Właścicielka domu publicznego.\n* **Volfzack:** Legendarny władca Archolos.\n* **Volker:** Lichwiarz, główny antagonista.\n* **Vrazka:** Uchodźczyni.\n* **Willem:** Ochroniarz na farmie Bermara.\n* **Winstan:** Trener strażników miejskich.\n* **Wirgilio:** Zmarły arcymag ognia.\n* **Yezegan:** Alchemik w Wilczym Leżu.\n* **Zachary:** Opiekun Ustronia Żeglarza.\n\n**Potwory występujące w Kronikach Myrtany**:\n- Wielkie nietoperze\n- Niedźwiedzie (zwyky i czarny)\n- Kraby\n- Żaboludzie\n- Golemy (kamienny i bagienny)\n- Harpie (zwykłe i czarne)\n- Pełzacze (zwykłe, polne, wojownicy)\n- Szkielety (wojownicy, łucznicy, kusznicy)\n- Zębacze, brzytwiaki, smocze zębacze\n- Zombie\n- Gobliny (zwykłe, szkielety, wojownicy, czarne)\n- Dziki\n- Bestie (polne oraz leśne)\n- Trutnie (bagienne oraz ściekowe)\n- Jaszczury (zwykłe, ogniste, bagienne), aligatory\n- Węże\n- Topielce (zwykłe i morskie)\n- Kretoszczury\n- Szczury (olbrzymie, bagienne, czarne)\n- Ścierwojady (zwykłe i leśne)\n- Wilki, czarne wilki, wargi, orkowe psy\n- Błotniaki\n- Cieniostwory (zwykłe i szkielety)\n- Trolle (zwykłe, bagienne, jaskiniowe)\n\n**Kroniki Myrtany: Archolos - Opis Fabuły**:\n\n* **Prolog:**\n\nNasza podróż do Archolos rozpoczyna się na statku piratów, gdzie przyszło nam spędzić czas pod pokładem z dość barwną kompanią. Poznajemy Ruperta, który narzeka na głód i prosi nas o pomoc w przygotowaniu szaszłyków. Polujemy na szczury, czytamy przepis i przygotowujemy posiłek na kuchence, zyskując wdzięczność Ruperta i przepis na kotlet grzybowy. Urs, stary wilk morski, oferuje nam lekcję otwierania zamków, wręczając zwój i wskazując skrzynię, na której możemy przetestować nowe umiejętności. Vrazka wspomina o zgubionej skrzyneczce, którą odnajdujemy przeszukując deski niedaleko skrzyni Ursa.  Aske, doświadczony łucznik, chętnie dzieli się swoją wiedzą w zamian za łyk grogu ze skrzyni, ucząc nas strugać strzały. Z Fabio, rozbitkiem o wybuchowym charakterze, możemy nawiązać nić porozumienia, oferując mu piwo, lub sprowokować go do bójki. Przez kraty ładowni zagadujemy do tajemniczego przemytnika, który rzuca enigmatyczne uwagi na temat wyspy. Spokój przerywa kapitan, wzywający nas na pokład. Jesteśmy świadkami brutalnego traktowania Timo przez załogę. Stajemy przed trudnym wyborem: stanąć w obronie Timo, ryzykując gniew kapitana, lub pozostać biernym obserwatorem.  Nasza decyzja zaważy na losie Timo – przeżyje i spotkamy go w Silbach, a później w tej samej gildii co my, lub zginie, a jego ciało i miecz zostaną wyrzucone na brzeg. Niezależnie od wyboru, kończymy za burtą, wrzuceni w wir wydarzeń na Archolos.\n\n* **Rozdział 1: Wątek Główny i Poboczny - Silbach**\n\nDopływamy do brzegu i spotykamy Jorna, który proponuje poszukiwania Ezekiela. Odnajdujemy go pogrążonego w żałobie po stracie córki.  Możemy przekonać go do pójścia z nami, co w przyszłości zaowocuje jego rolą handlarza w Silbach, lub zostawić go samego sobie, skazując na samotną śmierć na plaży.  Podążamy za Jornem do reszty rozbitków, którym przewodzi Fabio.  Jeśli wcześniej wybraliśmy drogę z Jornem, od razu udajemy się do Silbach. Jeśli poszliśmy z Fabio,  trafiamy do jaskini, gdzie pomagamy w obozowych obowiązkach.  Fabio prosi nas o zebranie drewna na opał. Możemy spróbować wymigać się od zadania, przypominając mu o piwie danym na statku, lub  walcząc z nim.  Jeśli się zgodzimy, zbieramy pięć kawałków chrustu porozrzucanych po okolicy.  Możemy też zbadać boczne odnogi jaskini – w jednej walczymy z goblinami, a w drugiej odkrywamy grobowce i pentagram, o których Fabio prosi nas, byśmy nikomu nie wspominali.  Nocą obóz atakują topielce. Wraz z Rupertem oczyszczamy drogę do Silbach, zabijając potwory i odnajdując zardzewiały klucz w brzuchu topielca. W Silbach strażnik wpuszcza nas do wioski, a my w końcu czujemy się bezpiecznie.  W karczmie spotykamy Kurta, który okazuje się być naszym bratem.  Dowiedzieliśmy się, że Jorn został ranny przez krwiopijcę i potrzebuje pomocy.  Kurt kieruje nas do Lokvara, miejscowego maga, który zgadza się przygotować lekarstwo w zamian za zioła.  Zbieramy je z pomocą Riordiana, modlącego się na cmentarzu. Po drodze uczymy się zaklęcia telekinezy, które okazuje się bardzo przydatne.  Z ziołami wracamy do Lokvara. Kurt prosi nas o pomoc dla Albyna, który potrzebuje ludzi do pracy przy odbudowie młyna. Rozpoczynamy rekrutację mieszkańców Silbach, przekonując Jorna, Ruperta, Maiwen, Leę, Fabio, Ezekiela, Timo i Kazeema. Każdy z nich ma swoje warunki i historie, które musimy poznać, by ich przekonać.  Po zebraniu ekipy wracamy do Albyna. Jorn proponuje nam trening walki.  Ćwiczymy z nim, a następnie idziemy do piekarza, gdzie znajdujemy ślad pustych butelek.  Trop prowadzi nas do skrzynki przy kociołku, gdzie odkrywamy sekret Jorna.  Wracamy do niego, a następnie udajemy się do Kurta, gdzie gotujemy zupę według przepisu i uczymy się otwierania zamków.  Jorn proponuje nam wyprawę do winnicy Rity.  Impreza kończy się nieprzytomnością i przebudzeniem w chacie Kurta.  Kurt prosi nas o zdobycie lekarstwa dla Jorna od Bodowina, alchemika mieszkającego niedaleko Silbach.  Bodowin zgadza się pomóc za opłatą lub w zamian za oczyszczenie okolicy jego chaty ze ścierwojadów.  Testujemy eliksir i wracamy z nim do Kurta, gdzie czeka nas niemiła niespodzianka – Jorn został porwany.\n\n\n* **Rozdział 2: Wątek Główny i Poboczny - Miasto i Okolice**\n\nRozpoczynamy poszukiwania Jorna, przeszukując chatę Kurta i zbierając wskazówki od mieszkańców Silbach. Trop prowadzi do miasta. Aby się tam dostać, musimy zdobyć glejt od Albyna, wykonać zadania dla Petry (dotyczące drwali lub kupca Salsera), przekupić strażnika Edgara lub skorzystać z tajnego wejścia do kanałów. W mieście dowiadujemy się, że aby cokolwiek zdziałać, musimy zostać obywatelem. Rozpoczynamy zbieranie referencji od mieszkańców, wykonując dla nich szereg zadań.  Frida zleca nam polowanie z Allanem, Leon chce, byśmy pomogli mu w grze w szachy, Tomas potrzebuje nowych partnerów handlowych dla swojego browaru, Ramona prosi o pomoc w rozwiązaniu konfliktu robotniczego, Ruud potrzebuje nastawienia barku, a Tengral chce, byśmy pomogli mu w sporze z paladynem Runarem.  Matey z urzędu zleca nam posprzątanie ulic.  Z referencjami wracamy do Mateya i zostajemy obywatelami.  Możemy teraz dołączyć do Straży Miejskiej lub Gildii Kupieckiej.  Wątek Gildii Kupieckiej koncentruje się na śledztwie w sprawie przemytu ludzi, które prowadzi nas do  Bursztynowego Wybrzeża i konfrontacji z Pablo. Wątek Straży Miejskiej  rozpoczyna się od poszukiwań zaginionego oddziału, co prowadzi nas do odkrycia spisku  i infiltracji obozu renegatów.  Obie ścieżki prowadzą do Przystani Łotrów. W międzyczasie wykonujemy liczne zadania poboczne dla mieszkańców miasta i okolic, odkrywając ich historie i problemy, takie jak pomoc Otmarowi w znalezieniu pijanego przewodnika, znalezienie schronienia dla Garda, pomoc Ewaldowi w dostawie materiałów, a także rozwiązując mniejsze problemy mieszkańców Silbach.\n\n\n* **Rozdział 3: Wątek Główny i Poboczny - Przystań Łotrów**\n\nNa Przystani Łotrów spotykamy Corteza i Bena. Jako członkowie Gildii Kupieckiej odzyskujemy skradzione wino zastawiając pułapkę na bandytów, a jako strażnicy badamy morderstwo Stana, co prowadzi do konfrontacji z Rodrigo i Simonem. Poznajemy dawnych znajomych ze statku, m.in. Aske.  Wykonujemy zadania dla Corteza, m.in. odzyskujemy skradzione towary, ratujemy rozbitków i szukamy zaginionych ludzi.  Bierzemy udział w turnieju, walcząc z Larrym, Otisem, Eileen/Javadem, Saulem i w finale z Benem. Po turnieju zdobywamy informacje od Bena na temat Jorna, używając trucizny, by rozwiązać mu język. Decydujemy o losie Bena, dając mu antidotum lub zostawiając na pewną śmierć.  Z informacjami od Bena wracamy do miasta, by zdać raport Lorenzo/Roderichowi. Na Przystani Łotrów wykonujemy też zadania poboczne, takie jak pomoc Saulowi w doprawieniu potrawki, odzyskanie sakiewki Larry'ego, poszukiwanie skarbów z Moritzem, pomoc Homerowi w ucieczce z niewoli, walki na pięści w Dzielnicy Pięści,  a także pomoc Nadine w odnalezieniu córki.\n\n\n* **Rozdział 4: Wątek Główny i Poboczny - Wilcze Leże**\n\nZ informacjami od Bena wracamy do miasta i dowiadujemy się o zamachu na Volkera.  Pomagamy w śledztwie, badając trzy tropy: grot, ulotki i więźnia.  Każdy trop prowadzi do innych podejrzanych i wymaga wykonania kolejnych zadań, takich jak przeszukanie cmentarza, rozmowa z robotnikami i infiltracja więzienia. Nasze wybory wpływają na to, kto ostatecznie zostanie oskarżony o zamach i stracony.  Volker wysyła nas do Wilczego Leża.  Aby się tam dostać, musimy przekonać uchodźców do odejścia lub zabić ich, albo spowodować lawinę.  Wewnątrz Leża szukamy wskazówek dotyczących Jorna.  Rozmawiamy z kowalem, który sprzedał groty użyte w zamachu,  i szukamy odpowiedniego łowcy.  Trop prowadzi do Jona w kopalni.  Wykonujemy zadania dla Ulryka, zabijając pełzacze i orków.  W kopalni odkrywamy spisek przeciwko Volkerowi.  Odkrywamy też sekretną kryjówkę, gdzie znajdujemy mapę prowadzącą do miejsca przetrzymywania Jorna.  Uciekamy z Leża.  W Wilczym Leżu wykonujemy również zadania poboczne, takie jak  pomoc Nelsonowi w zdobyciu rogu cieniostwora, dostarczenie trunków dla Dirka, zebranie wilczych skór dla Baesa,  pomoc Tonanowi w uwolnieniu zjawy, znalezienie koła zębatego dla Lucasa, obstawianie walk w obozie Loria,  testowanie eliksirów przemiany dla Yezegana, polowanie na bestię z Archolos dla Ramseya, pomoc drwalowi w dostawie srebra i stali,  pełnienie nocnej warty dla Aretha, a także rozprawienie się z grupą renegatów odpowiedzialną za porwanie Jorna.\n\n\n* **Rozdział 5: Wątek Główny i Poboczny - Klasztor Magów Wody i Twierdza Vardhal**\n\nPo ucieczce z Leża trafiamy do Klasztoru Magów Wody.  Z pomocą Riordiana i Any przygotowujemy miksturę, która odsłania nam wizję Twierdzy Vardhal, gdzie przetrzymywany jest Jorn.  W klasztorze wykonujemy zadania dla magów i nowicjuszy, m.in. uciekamy z laboratorium jako zmniejszona wersja siebie, pomagamy Candakowi uporać się z problemem nieumarłych na cmentarzu, badamy sprawę plagi ścierwojadów, szukamy zagubionych przedmiotów Artura i zbieramy rośliny dla ogrodnika. Przygotowujemy się do wyprawy do Vardhal, zbierając zapasy i rekrutując towarzyszy. Wśród nich mogą znaleźć się m.in. Bastian, Ezekiel, Viktor, Rupert, Helga, Rita, Tengral, Slager, Bevin, Dima, Tomas, Zachary, Helmud, Knut, Pablo, Ernesto,  Candac, Ilse, Ben, Fane, Caramon, Lutz, Arwid, Berto, Cortez,  Javed i Griff.  W ruinach Vardhal walczymy z nieumarłymi, szukamy fragmentów klucza i odkrywamy tajemnice twierdzy.  Odnajdujemy Jorna i Rozjemcę – legendarny miecz.  Konfrontujemy się z Ulrykiem i musimy podjąć trudną decyzję – oddać Rozjemcę lub walczyć.\n\n\n* **Rozdział 6: Wątek Główny i Poboczny - Czarna Godzina**\n\nPo wydarzeniach w Vardhal wracamy do miasta, które jest atakowane przez ludzi Volkera i Wilczych Synów.  Pomagamy mieszkańcom, bronimy miasta i konfrontujemy się z byłymi sojusznikami. Nasze wybory w poprzednich rozdziałach determinują, kogo spotkamy i z kim będziemy walczyć.  Chronimy magów ognia, walczymy z Yezeganem i Osipem, decydujemy o losie Alferda.  Spotykamy Riordiana, który oferuje nam wybór – chronić Archolos lub skupić się na zemście na Lichwiarzu.  Decyzja ta  wpływa na ostateczną konfrontację -  z Volkerem lub  bezpośrednio z Lichwiarzem.  W kanałach spotykamy Ivy i decydujemy o jej losie.  Ostateczna walka z Lichwiarzem/Volkerem kończy naszą przygodę na Archolos.\n\n\n**Lista customowych emoji których możesz używać**:\n:5ZLOTYCH:\n:FeelsRetarded:\n:ModOfTheDecade:\n:OmegaLUL:\n:RODERICH:\n:SwagHappy:\n:SwagSmirk:\n:ahaha:\n:anyaheh:\n:banhammer:\n:besmart:\n:beyeszoom:\n:blobStress:\n:blobSus:\n:buffdoge:\n:chadstream:\n:cheems:\n:clownge:\n:ddsanity:\n:depressed:\n:dogecri:\n:dogegun:\n:ehh:\n:engplease:\n:gigachad:\n:gotcha:\n:guessdie:\n:harad4th:\n:haski:\n:haskicri:\n:he:\n:hmm:\n:hmm4:\n:isleep:\n:kekq:\n:kekw:\n:kekwpog:\n:kmlogo:\n:koperek:\n:kz:\n:legit:\n:lullll:\n:marv:\n:marve:\n:marvin:\n:mhm:\n:monkaGIGA:\n:monstereksip:\n:nameless4th:\n:noted:\n:notlikethis:\n:ok_pepe:\n:okzoomer:\n:pOg:\n:pain:\n:pathetic:\n:peepoDrink:\n:peepoParty1:\n:peepoParty2:\n:peepoParty3:\n:peepolove:\n:pepeEZ:\n:pepeToast:\n:pepehands:\n:pepelaugh:\n:pika:\n:plus:\n:potionseller:\n:praisethesun:\n:prayge:\n:reeee:\n:report:\n:sadeg:\n:sadge:\n:salute:\n:shineglasses:\n:shrugtom:\n:skillissue:\n:sleeper:\n:spierdaczka:\n:stonks:\n:susge:\n:sweetpeepo:\n:tea~1:\n:tflmao:\n:thinkingsus:\n:uhoh_Guido:\n:uncannymarv:\n:underdogo:\n:vaana:\n:whatcat:\n:why:\n:wutckle:\n:yes:\n:ziele:\n:MONKE:\n:ahitdance:\n:cashwave:\n:catjam:\n:catreee:\n:cooldoge:\n:dogedance:\n:dogepet:\n:duckdance:\n:ezclap:\n:honkpeepo:\n:kekboom:\n:kekwd:\n:kermitfire:\n:moneyrain:\n:peperain:\n:pogfish:\n:porvalo:\n:pugpls:\n:ratjam:\n:ricardoflick:\n:silphco:\n:susrock:\n:unocard:\n:whoasked:\n\n**Aktywni użytkownicy discorda Kronik Myrtany**:\nrebrond: Wydaje się być jednym z najbardziej aktywnych użytkowników, często inicjuje rozmowy i zadaje pytania, zarówno na tematy związane z Gothiciem, jak i inne. Lubi żartować i prowokować, często używa memów i nawiązuje do popkultury. Wykazuje się również sporą wiedzą na temat gier, zwłaszcza serii Gothic i Dark Souls. Często proponuje też wspólne granie.\n\nnuviusz: Drugi bardzo aktywny użytkownik. Podobnie jak rebrond, chętnie uczestniczy w rozmowach i zadaje pytania. Jego znakiem rozpoznawczym jest \"lucek\", kot, którego zdjęcia i gify regularnie pojawiają się na czacie. Lubi żartować, często używając sarkazmu i absurdalnego humoru. Interesuje się grami, zwłaszcza Gothic, Ultrakill i Don't Starve Together. Wykazuje się też zainteresowaniem tworzeniem gier i pisaniem lore. Mieszka na Podlasiu.\n\ns_h_0_u_n: Użytkownik z dużą wiedzą techniczną, często udziela porad i wyjaśnień na tematy związane z oprogramowaniem, szczególnie z moddingiem Gothica i systemami Linux. Jego wypowiedzi są konkretne i merytoryczne, choć czasem używa mocnego języka. Wydaje się być osobą bezpośrednią i nieco zrzędliwą, ale chętną do pomocy. Z logów wynika, że ma kota o imieniu Stefan i boryka się z problemami zdrowotnymi.\n\nkubanski: Aktywny użytkownik, chętnie uczestniczy w rozmowach i dzieli się swoimi opiniami na temat gier. Lubi żartować i używać memów. Interesuje się szczególnie serią Gothic, Metal Gear Solid i Fear and Hunger. Wydaje się być osobą otwartą i towarzyską.\n\nhry123: Użytkownik z dużą wiedzą na temat Gothica, szczególnie jego aspektów technicznych i moddingu. Często udziela pomocy i wskazówek innym użytkownikom. Jego wypowiedzi są konkretne i merytoryczne. Interesuje się także innymi grami, np. Dark Souls i Left 4 Dead.\n\nx4vv: Aktywny admin jeden z twórców moda Kroniki Myrtany, często inicjuje rozmowy na temat gier, szczególnie z gatunku souls-like. Lubi dzielić się swoimi opiniami i recenzjami. Używa memów i często pisze po angielsku. Wykazuje się dużym zainteresowaniem technologią i oprogramowaniem, szczególnie systemami Linux.\n\nmikhtar: Aktywny użytkownik, chętnie uczestniczy w rozmowach, zadaje pytania i dzieli się swoimi opiniami. Lubi żartować i używać memów, często nawiązuje do popkultury. Interesuje się grami, zwłaszcza Gothic, Dark Souls i Warhammer.\n\nchristopher9044: Aktywny użytkownik, chętnie uczestniczy w rozmowach i dzieli się swoimi opiniami na temat gier. Lubi żartować i używać memów. Interesuje się szczególnie serią Gothic i kotami.\n\n.pwned: Aktywny użytkownik, chętnie uczestniczy w rozmowach i zadaje pytania. Lubi żartować i używać memów. Interesuje się grami i posiada psa rasy husky.\n\n.pawloch: Jeden z twórców Kronik Myrtany.\n\n **Przykłady zdjęć postaci z Kronik Myrtany z opisami**:\n\n";

    // Temperature setting - User can modify this (0.0 to 1.0)
    let temperature = 0.7;


    let emoticonsMap = new Map([
        ['5ZLOTYCH', 'https://cdn.discordapp.com/emojis/1306356283330396230.webp?size=48'],
        ['FeelsRetarded', 'https://cdn.discordapp.com/emojis/882010666674819082.webp?size=48'],
        ['ModOfTheDecade', 'https://cdn.discordapp.com/emojis/1023326511601819719.webp?size=48'],
        ['OmegaLUL', 'https://cdn.discordapp.com/emojis/859536449698922516.webp?size=48'],
        ['RODERICH', 'https://cdn.discordapp.com/emojis/1256335874820542665.webp?size=48'],
        ['SwagHappy', 'https://cdn.discordapp.com/emojis/954923570180546570.webp?size=48'],
        ['SwagSmirk', 'https://cdn.discordapp.com/emojis/1295101966938275880.webp?size=48'],
        ['ahaha', 'https://cdn.discordapp.com/emojis/954407468555964476.webp?size=48'],
        ['anyaheh', 'https://cdn.discordapp.com/emojis/964169768896696322.webp?size=48'],
        ['banhammer', 'https://cdn.discordapp.com/emojis/909140380493185056.webp?size=48'],
        ['besmart', 'https://cdn.discordapp.com/emojis/909140839073206272.webp?size=48'],
        ['beyeszoom', 'https://cdn.discordapp.com/emojis/880543180930564157.webp?size=48'],
        ['blobStress', 'https://cdn.discordapp.com/emojis/965086711749173248.webp?size=48'],
        ['blobSus', 'https://cdn.discordapp.com/emojis/967861608606998558.webp?size=48'],
        ['buffdoge', 'https://cdn.discordapp.com/emojis/909825598430515200.webp?size=48'],
        ['chadstream', 'https://cdn.discordapp.com/emojis/958346334497292308.webp?size=48'],
        ['cheems', 'https://cdn.discordapp.com/emojis/853278456330190868.webp?size=48'],
        ['clownge', 'https://cdn.discordapp.com/emojis/934195588810043452.webp?size=48'],
        ['ddsanity', 'https://cdn.discordapp.com/emojis/1049765343461134407.webp?size=48'],
        ['depressed', 'https://cdn.discordapp.com/emojis/979438675194691625.webp?size=48'],
        ['dogecri', 'https://cdn.discordapp.com/emojis/887401571363733674.webp?size=48'],
        ['dogegun', 'https://cdn.discordapp.com/emojis/909447431681368134.webp?size=48'],
        ['ehh', 'https://cdn.discordapp.com/emojis/1299473675665539076.webp?size=48'],
        ['engplease', 'https://cdn.discordapp.com/emojis/910196983984164904.webp?size=48'],
        ['gigachad', 'https://cdn.discordapp.com/emojis/853268431130066955.webp?size=48'],
        ['gotcha', 'https://cdn.discordapp.com/emojis/956115382454845520.webp?size=48'],
        ['guessdie', 'https://cdn.discordapp.com/emojis/938057411439263744.webp?size=48'],
        ['harad4th', 'https://cdn.discordapp.com/emojis/944697650417119252.webp?size=48'],
        ['haski', 'https://cdn.discordapp.com/emojis/1099000450021335132.webp?size=48'],
        ['haskicri', 'https://cdn.discordapp.com/emojis/1099069706515796101.webp?size=48'],
        ['he', 'https://cdn.discordapp.com/emojis/1006334359181201438.webp?size=48'],
        ['hmm', 'https://cdn.discordapp.com/emojis/954401284964876308.webp?size=48'],
        ['hmm4', 'https://cdn.discordapp.com/emojis/1079721727891869756.webp?size=48'],
        ['isleep', 'https://cdn.discordapp.com/emojis/934220335274930236.webp?size=48'],
        ['kekq', 'https://cdn.discordapp.com/emojis/955796239943884800.webp?size=48'],
        ['kekw', 'https://cdn.discordapp.com/emojis/853275799993712640.webp?size=48'],
        ['kekwpog', 'https://cdn.discordapp.com/emojis/906011370678526012.webp?size=48'],
        ['kmlogo', 'https://cdn.discordapp.com/emojis/874302609253605386.webp?size=48'],
        ['koperek', 'https://cdn.discordapp.com/emojis/883466586990735440.webp?size=48'],
        ['kz', 'https://cdn.discordapp.com/emojis/885991644283949147.webp?size=48'],
        ['legit', 'https://cdn.discordapp.com/emojis/934195594157776937.webp?size=48'],
        ['lullll', 'https://cdn.discordapp.com/emojis/859396689655758878.webp?size=48'],
        ['marv', 'https://cdn.discordapp.com/emojis/1240020801575452705.webp?size=48'],
        ['marve', 'https://cdn.discordapp.com/emojis/920300862738427985.webp?size=48'],
        ['marvin', 'https://cdn.discordapp.com/emojis/909227359641686026.webp?size=48'],
        ['mhm', 'https://cdn.discordapp.com/emojis/954403979931050094.webp?size=48'],
        ['monkaGIGA', 'https://cdn.discordapp.com/emojis/882010666523848746.webp?size=48'],
        ['monstereksip', 'https://cdn.discordapp.com/emojis/931017311559770113.webp?size=48'],
        ['nameless4th', 'https://cdn.discordapp.com/emojis/944697636353630258.webp?size=48'],
        ['noted', 'https://cdn.discordapp.com/emojis/882010666641272893.webp?size=48'],
        ['notlikethis', 'https://cdn.discordapp.com/emojis/881244910878077038.webp?size=48'],
        ['ok_pepe', 'https://cdn.discordapp.com/emojis/962749480728428574.webp?size=48'],
        ['okzoomer', 'https://cdn.discordapp.com/emojis/910197005844893776.webp?size=48'],
        ['pOg', 'https://cdn.discordapp.com/emojis/853251919287418890.webp?size=48'],
        ['pain', 'https://cdn.discordapp.com/emojis/877218846354866186.webp?size=48'],
        ['pathetic', 'https://cdn.discordapp.com/emojis/909142031396388954.webp?size=48'],
        ['peepoDrink', 'https://cdn.discordapp.com/emojis/1057246000617635870.webp?size=48'],
        ['peepoParty1', 'https://cdn.discordapp.com/emojis/1057244077017534524.webp?size=48'],
        ['peepoParty2', 'https://cdn.discordapp.com/emojis/1057244096776900668.webp?size=48'],
        ['peepoParty3', 'https://cdn.discordapp.com/emojis/1057244119874928650.webp?size=48'],
        ['peepolove', 'https://cdn.discordapp.com/emojis/853251901943316560.webp?size=48'],
        ['pepeEZ', 'https://cdn.discordapp.com/emojis/888034795345571860.webp?size=48'],
        ['pepeToast', 'https://cdn.discordapp.com/emojis/1057244050966728734.webp?size=48'],
        ['pepehands', 'https://cdn.discordapp.com/emojis/875401613827772488.webp?size=48'],
        ['pepelaugh', 'https://cdn.discordapp.com/emojis/887087414928080986.webp?size=48'],
        ['pika', 'https://cdn.discordapp.com/emojis/909142687842725938.webp?size=48'],
        ['plus', 'https://cdn.discordapp.com/emojis/853279501688897588.webp?size=48'],
        ['potionseller', 'https://cdn.discordapp.com/emojis/934195608921722920.webp?size=48'],
        ['praisethesun', 'https://cdn.discordapp.com/emojis/882010666871947274.webp?size=48'],
        ['prayge', 'https://cdn.discordapp.com/emojis/934195565934301274.webp?size=48'],
        ['reeee', 'https://cdn.discordapp.com/emojis/882010666800676885.webp?size=48'],
        ['report', 'https://cdn.discordapp.com/emojis/909496703550373949.webp?size=48'],
        ['sadeg', 'https://cdn.discordapp.com/emojis/938056614223687731.webp?size=48'],
        ['sadge', 'https://cdn.discordapp.com/emojis/934195518836457482.webp?size=48'],
        ['salute', 'https://cdn.discordapp.com/emojis/882010666301530155.webp?size=48'],
        ['shineglasses', 'https://cdn.discordapp.com/emojis/934195612474310666.webp?size=48'],
        ['shrugtom', 'https://cdn.discordapp.com/emojis/938057420939341864.webp?size=48'],
        ['skillissue', 'https://cdn.discordapp.com/emojis/1099343364136120350.webp?size=48'],
        ['sleeper', 'https://cdn.discordapp.com/emojis/958641187596685312.webp?size=48'],
        ['spierdaczka', 'https://cdn.discordapp.com/emojis/1279557887881904128.webp?size=48'],
        ['stonks', 'https://cdn.discordapp.com/emojis/881680669506424833.webp?size=48'],
        ['susge', 'https://cdn.discordapp.com/emojis/924538989522853899.webp?size=48'],
        ['sweetpeepo', 'https://cdn.discordapp.com/emojis/882009031672229948.webp?size=48'],
        ['tea~1', 'https://cdn.discordapp.com/emojis/853251929374326785.webp?size=48'],
        ['tflmao', 'https://cdn.discordapp.com/emojis/954400960548065432.webp?size=48'],
        ['thinkingsus', 'https://cdn.discordapp.com/emojis/910208312497299486.webp?size=48'],
        ['uhoh_Guido', 'https://cdn.discordapp.com/emojis/954423830036750466.webp?size=48'],
        ['uncannymarv', 'https://cdn.discordapp.com/emojis/931294296999604294.webp?size=48'],
        ['underdogo', 'https://cdn.discordapp.com/emojis/988526761933434910.webp?size=48'],
        ['vaana', 'https://cdn.discordapp.com/emojis/1161043050500464691.webp?size=48'],
        ['whatcat', 'https://cdn.discordapp.com/emojis/909143204396425246.webp?size=48'],
        ['why', 'https://cdn.discordapp.com/emojis/958670938809987112.webp?size=48'],
        ['wutckle', 'https://cdn.discordapp.com/emojis/934195602751885352.webp?size=48'],
        ['yes', 'https://cdn.discordapp.com/emojis/853268442457833482.webp?size=48'],
        ['ziele', 'https://cdn.discordapp.com/emojis/909227348400959509.webp?size=48'],
        ['MONKE', 'https://cdn.discordapp.com/emojis/909508579004928042.webp?size=48&animated=true'],
        ['ahitdance', 'https://cdn.discordapp.com/emojis/909507272009474078.webp?size=48&animated=true'],
        ['cashwave', 'https://cdn.discordapp.com/emojis/915026532433543198.webp?size=48&animated=true'],
        ['catjam', 'https://cdn.discordapp.com/emojis/909454894958788710.webp?size=48&animated=true'],
        ['catreee', 'https://cdn.discordapp.com/emojis/909496679835787285.webp?size=48&animated=true'],
        ['cooldoge', 'https://cdn.discordapp.com/emojis/909825495137403011.webp?size=48&animated=true'],
        ['dogedance', 'https://cdn.discordapp.com/emojis/909508930248536085.webp?size=48&animated=true'],
        ['dogepet', 'https://cdn.discordapp.com/emojis/909496040258957362.webp?size=48&animated=true'],
        ['duckdance', 'https://cdn.discordapp.com/emojis/909507286769205289.webp?size=48&animated=true'],
        ['ezclap', 'https://cdn.discordapp.com/emojis/909496651822014464.webp?size=48&animated=true'],
        ['honkpeepo', 'https://cdn.discordapp.com/emojis/909144840711843901.webp?size=48&animated=true'],
        ['kekboom', 'https://cdn.discordapp.com/emojis/909454862226452530.webp?size=48&animated=true'],
        ['kekwd', 'https://cdn.discordapp.com/emojis/909496642271600663.webp?size=48&animated=true'],
        ['kermitfire', 'https://cdn.discordapp.com/emojis/909825510928945203.webp?size=48&animated=true'],
        ['moneyrain', 'https://cdn.discordapp.com/emojis/910196994952278036.webp?size=48&animated=true'],
        ['peperain', 'https://cdn.discordapp.com/emojis/909507301910671360.webp?size=48&animated=true'],
        ['pogfish', 'https://cdn.discordapp.com/emojis/909507757894406197.webp?size=48&animated=true'],
        ['porvalo', 'https://cdn.discordapp.com/emojis/954399111287832616.webp?size=48&animated=true'],
        ['pugpls', 'https://cdn.discordapp.com/emojis/909496531302907984.webp?size=48&animated=true'],
        ['ratjam', 'https://cdn.discordapp.com/emojis/909508562005405736.webp?size=48&animated=true'],
        ['ricardoflick', 'https://cdn.discordapp.com/emojis/909508205414055976.webp?size=48&animated=true'],
        ['silphco', 'https://cdn.discordapp.com/emojis/934199536904175726.webp?size=48&animated=true'],
        ['susrock', 'https://cdn.discordapp.com/emojis/934198916340154448.webp?size=48&animated=true'],
        ['unocard', 'https://cdn.discordapp.com/emojis/909496073502982184.webp?size=48&animated=true'],
        ['whoasked', 'https://cdn.discordapp.com/emojis/909496585728180264.webp?size=48&animated=true']
    ]);


let chatHistory = [

    ];



// Replace your existing aiChatHistory with this:
let aiChatHistory = [
];
  
let userChatHistory = [];

function encodeImageFileAsBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result.split(',')[1]);
        reader.onerror = (error) => reject(error);
        reader.readAsDataURL(file);
    });
}


// Function to parse emoticons in a message
function parseEmoticons(message) {
    const emoticonRegex = /:([^:\s]+):/g;
    return message.replace(emoticonRegex, (match, emoticonName) => {
        const emoticonKey = [...emoticonsMap.keys()].find(key => key.toLowerCase() === emoticonName.toLowerCase());
        if (emoticonKey) {
            const emoticonUrl = emoticonsMap.get(emoticonKey);
            return `<img src="${emoticonUrl}" alt=":${emoticonKey}:" style="display: inline-block; vertical-align: middle; height: 24px;">`;
        }
        return ''; // Return empty string for emojis not in the map instead of returning the match
    });
}




// Function to add a message to the chat container with streaming for AI responses
async function addMessage(message, isUser = false, imageData = null, imageName = null) {
    const chatContainer = document.getElementById('chat-container');
    const messageContainer = document.createElement('div');
    messageContainer.className = `message-container ${isUser ? 'user-message-container' : ''}`;

    const avatar = document.createElement('img');
    avatar.className = `avatar ${isUser ? 'user' : ''}`;
    avatar.src = isUser ? 'default.png' : 'spierdaczka.png';
    messageContainer.appendChild(avatar);

    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${isUser ? 'user-message' : 'ai-message'}`;

    if (imageData && !isUser && imageName) {  // AI image
        const img = document.createElement('img');
        img.src = `data:image/jpeg;base64,${imageData}`;
        img.alt = imageName;
        img.style.maxWidth = '200px'; img.style.maxHeight = '200px';
        messageDiv.appendChild(img);
    } else if (imageData && isUser) {           // User image
        const img = document.createElement('img');
        img.src = `data:image/jpeg;base64,${imageData}`;
        img.alt = imageName || "Uploaded Image";
        img.style.maxWidth = '200px'; img.style.maxHeight = '200px';
        messageDiv.appendChild(img);
    }

    if (message) {
        messageDiv.innerHTML += parseEmoticons(message.replace(/\n/g, '<br>'));
    }

    messageContainer.appendChild(messageDiv);
    chatContainer.appendChild(messageContainer);
    chatContainer.scrollTop = chatContainer.scrollHeight;
}

// Function to stream the AI response text
async function streamResponse(message, messageDiv) {
    let streamedText = "";
    for (let char of message) {
        streamedText += char;
        messageDiv.innerHTML = parseEmoticons(streamedText.replace(/\n/g, '<br>'));
        await new Promise(resolve => setTimeout(resolve, 20));
    }
}

let uploadedImageData = null;
let uploadedImageName = null;

function handleFileSelect(event) {
    const file = event.target.files[0];
    if (file) {
        uploadedImageName = file.name; // Store the uploaded image name
        encodeImageFileAsBase64(file)
            .then(base64data => {
                uploadedImageData = base64data; // Temporarily store image data
                //alert(`Image "${uploadedImageName}" uploaded! You can now add a message and click Send.`);
            })
            .catch(error => {
                console.error("Error encoding image:", error);
            });
    }
}

// Event listener for the image upload button
document.getElementById('image-upload').addEventListener('change', handleFileSelect);
document.getElementById('upload-image-button').addEventListener('click', () => {
    document.getElementById('image-upload').click();
});


// Function to send user input and/or image data to the AI API
async function generateResponse(userMessage, imageData = null, imageName = null) {
    let combinedHistory = [...aiChatHistory, ...userChatHistory];

    // Start with the system prompt
    let parts = [{ text: systemPrompt + "\n\n" }]; // System prompt FIRST

    let firstUserMessageAdded = false; // Flag to track if the first user message has been added

    for (const msg of combinedHistory) {
        if (msg.role === 'user' && !firstUserMessageAdded) {
            // Insert the start of the conversation text before the first user message
            parts.push({ text: "==== Początek rozmowy ====\n\n" });
            firstUserMessageAdded = true;
        }

        if (msg.role) {
            parts.push({ text: `${msg.role}: ` });
        }

        // Add the text content if it exists
        if (msg.content) {
            parts.push({ text: msg.content + "\n" });
        }

        // Add the image if it exists
        if (msg.imageData && msg.imageName) {
            parts.push({
                inline_data: {
                    mime_type: "image/jpeg",
                    data: msg.imageData
                }
            });
        }
    }

    // Add the current user message and image (ONLY if present)
    if (userMessage) {
        if (!firstUserMessageAdded) {
            // Add the start of conversation text before the current user message
            parts.push({ text: "==== Start of conversation with user ====\n\n" });
            firstUserMessageAdded = true;
        }
        parts.push({ text: `user: ${userMessage}\n` });
    }

    if (imageData && imageName) { // Check both are present to avoid duplication
        parts.push({
            inline_data: {
                mime_type: "image/jpeg", // Or correct MIME type
                data: imageData
            }
        });
    }

    const data = {
        contents: [{ parts: parts }],
        generationConfig: { temperature }
    };

    console.log("Payload being sent to API:");
    console.log(JSON.stringify(data, null, 2));

    const models = ['gemini-1.5-pro', 'gemini-2.0-flash-exp', 'gemini-exp-1206', 'gemini-exp-1121', 'gemini-exp-1114'];
    const fallbackModel = 'gemini-1.5-flash';
    const apiKeys = [apiKey1, apiKey2]; // Use both API keys

    // Try each API key in sequence
    for (const apiKey of apiKeys) {
        for (const model of models) {
            console.log(`Attempting to send request to model: ${model}`);
            try {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log(`Response from model ${model}:`, result);

                    const textContent = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (textContent) {
                        const cleanedResponse = cleanResponse(textContent);

                        // Extract potential image from AI's response
                        const imageDescriptionMatch = cleanedResponse.match(/\[Dołączono zdjęcie o nazwie: "(.*?)"\]/);
                        let imageNameFromResponse = null;
                        let imageDataFromResponse = null;

                        if (imageDescriptionMatch) {
                            imageNameFromResponse = imageDescriptionMatch[1];
                            cleanedResponse = cleanedResponse.replace(imageDescriptionMatch[0], ''); // Remove description

                            const imagePart = result?.candidates?.[0]?.content?.parts?.[1];
                            if (imagePart && imagePart.inline_data && imagePart.inline_data.data) {
                                imageDataFromResponse = imagePart.inline_data.data;
                            }
                        }
                        return { cleanedResponse, imageDataFromResponse, imageNameFromResponse };
                    } else {
                        console.warn(`Model ${model} returned no valid content.`);
                    }
                } else {
                    console.error(`Failed response from model ${model}: Status ${response.status}`);
                }

            } catch (error) {
                console.error(`Error with model ${model} and API key ${apiKey}:`, error);
            }
        }
    }

    // If all attempts fail, try the fallback model with both API keys
    for (const apiKey of apiKeys) {
        try {
            console.log(`Attempting fallback model: ${fallbackModel} with API key: ${apiKey}`);
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${fallbackModel}:generateContent?key=${apiKey}`;
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                const result = await response.json();
                const textContent = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                if (textContent) {
                    const cleanedResponse = cleanResponse(textContent);
                    return { cleanedResponse, imageDataFromResponse: null, imageNameFromResponse: null };
                }
            } else {
                console.error(`Fallback model failed with API key ${apiKey}: Status ${response.status}`);
            }
        } catch (error) {
            console.error(`Error with fallback model ${fallbackModel} and API key ${apiKey}:`, error);
        }
    }

    // If everything fails
    return { cleanedResponse: "Coś się zesrało :ehh:", imageDataFromResponse: null, imageNameFromResponse: null };
}





// Function to handle user message input and initiate response generation
async function handleMessage() {
    const input = document.getElementById('message-input');
    const userMessage = input.value.trim();

    if (!userMessage && !uploadedImageData) return;

    addMessage(userMessage, true, uploadedImageData, uploadedImageName); // Add to UI

    userChatHistory.push({
    role: "user",
    content: userMessage || null,
    imageData: uploadedImageData || null,
    imageName: uploadedImageName || null
});



    input.value = '';
    const imageDataToSend = uploadedImageData;
    const imageNameToSend = uploadedImageName;
    uploadedImageData = null;
    uploadedImageName = null;

    const { cleanedResponse, imageDataFromResponse, imageNameFromResponse } = await generateResponse(userMessage, imageDataToSend, imageNameToSend);
    addMessage(cleanedResponse, false, imageDataFromResponse, imageNameFromResponse);

    userChatHistory.push({
    role: "model",
    content: cleanedResponse,
    imageData: imageDataFromResponse || null,
    imageName: imageNameFromResponse || null
});
}

// Event listeners for sending messages
document.getElementById('send-button').addEventListener('click', handleMessage);
document.getElementById('message-input').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        handleMessage();
    }
});



// Function to clean responses by removing user prefixes
function cleanResponse(response) {
    const userPatterns = [
        /user:/i,
        /human:/i,
        /question:/i,
        /\[user\]/i,
        /\[human\]/i,
        /\[question\]/i
    ];

    let cleanedResponse = response;
    for (const pattern of userPatterns) {
        const index = cleanedResponse.search(pattern);
        if (index !== -1) {
            cleanedResponse = cleanedResponse.substring(0, index).trim();
            break;
        }
    }

    const secondCheck = userPatterns.some(pattern => pattern.test(cleanedResponse));
    if (secondCheck) {
        return cleanResponse(cleanedResponse);
    }
    return cleanedResponse;
}
document.getElementById('send-button').addEventListener('click', handleMessage);

document.addEventListener('DOMContentLoaded', () => {
createRoderich();
chatHistory.forEach(entry => {
        addMessage(entry.parts[0].text, entry.role === "user", entry.imageData, entry.imageName);
    });
const input = document.getElementById('message-input');
const sendButton = document.getElementById('send-button');

input.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        handleMessage();
    }
});

sendButton.addEventListener('click', handleMessage);
});

    function createRoderich() {
        const randomYPosition = Math.random() * 68;
        //console.log('Generated yPosition:', randomYPosition);

        const config = {
            size: '50px',
            rotation: '60deg',
            duration: '3s',
            timing: 'ease-in-out',
            xPosition: '0px',
            yPosition: `${randomYPosition}vh`, // Apply random value
            peekInterval: 5000,
            peekProbability: 0.2
        };

        const roderich = document.createElement('img');
        roderich.src = 'roderich.png';
        roderich.className = 'roderich';
        
        roderich.style.setProperty('--roderich-size', config.size);
        roderich.style.setProperty('--peek-rotation', config.rotation);
        roderich.style.setProperty('--peek-duration', config.duration);
        roderich.style.setProperty('--peek-timing', config.timing);
        roderich.style.setProperty('--x-position', config.xPosition);
        roderich.style.setProperty('--y-position', config.yPosition);
        
        document.body.appendChild(roderich);

        function makeRoderichPeek() {
            const side = Math.random() < 0.5 ? 'left' : 'right';

            // Generate a random Y position between 0 and 90
            const randomYPosition = Math.random() * 68;
            //console.log('Generated Y position for peek:', randomYPosition);

            // Apply the random Y position to the roderich element
            roderich.style.top = `${randomYPosition}vh`;

            if (side === 'left') {
                roderich.style.left = '0';
                roderich.style.right = 'auto';
                roderich.style.animation = `peekabooLeft ${config.duration} ${config.timing}`;
            } else {
                roderich.style.right = '0';
                roderich.style.left = 'auto';
                roderich.style.animation = `peekabooRight ${config.duration} ${config.timing}`;
            }

            setTimeout(() => {
                roderich.style.animation = 'none';
            }, parseFloat(config.duration) * 1000);
        }

        setTimeout(makeRoderichPeek, 1000);

        setInterval(() => {
            if (Math.random() < config.peekProbability) {
                makeRoderichPeek();
            }
        }, config.peekInterval);
    }
</script>
</body>
</html>